sudo: required
dist: trusty
language: bash

stages:
  - name: Python test
    if: branch = master
# - name: Python test
#     if: branch != master
   - name: Push artifact
     if: branch = master
services:
  - docker

install:
  - sudo apt-add-repository "deb http://archive.ubuntu.com/ubuntu trusty-backports main restricted universe multiverse"
  - sudo apt-get -qq update
  - sudo apt-get -t trusty-backports install shellcheck
  - sudo pip install awscli

jobs:
  include:
    - stage: Python test
      script:
        - echo "Check for commit ${TRAVIS_COMMIT} and tag ${TRAVIS_TAG} from branch ${TRAVIS_BRANCH}."
        - echo "This is build number ${TRAVIS_BUILD_NUMBER}, for ${TRAVIS_REPO_SLUG}."
        - mkdir /tmp/config-custom
        - docker pull almerhor/pylint:default
        - docker run --rm -v $(pwd):/pylint -v $(pwd)/test:/tmp/config-custom almerhor/pylint:default py/CloudControlStateActionEc2.py requirements-custom.txt
    - stage: Push artifact
      script:
        - zip CloudControlStateActionEc2.zip py/CloudControlStateActionEc2.py
        - aws s3 cp CloudControlStateActionEc2.zip s3://pawel-alexa-cloud-control/CloudControlStateActionEc2.zip